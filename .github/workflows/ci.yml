# File: .github/workflows/ci.yml

name: Django CI/CD

on:
  push:
    branches: [ main, feature/** ] # Runs on pushes to main and any feature branch
  pull_request:
    branches: [ main ] # Runs on pull requests targeting main

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Use your project's target Python version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # Assuming your dependencies are listed in a requirements.txt file
          pip install -r backend/requirements.txt 
          # You will need to create this file by running `pip freeze > backend/requirements.txt`

      - name: Run Linters (if configured)
        # Placeholder step: Replace 'flake8' with your actual linter command
        # You will need to install the linter in the previous step (e.g., pip install flake8)
        run: |
          echo "No linters configured yet. Add flake8 or black here."
          # Example: flake8 backend/

      - name: Run Tests
        # Runs the standard Django test command
        # Note: You may need a step to set up a minimal database (like SQLite) 
        # or mock your Supabase connection for faster tests.
        run: |
          # Set minimum required environment variables for the test command to run
          export SECRET_KEY='ci-secret-key'
          export DEBUG=True
          python backend/manage.py test